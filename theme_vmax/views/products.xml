<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="vm_products_attributes" inherit_id="website_sale.products_attributes" name="Custom Attribute Product">
        <xpath expr="//t[@t-foreach='attributes']/li" position="attributes">
            <attribute name="class" separator=" " add="tp-sidebar-attribute py-3" />
        </xpath>
        <xpath expr="//t[@t-foreach='attributes']/li/div" position="replace">
            <div class="d-flex justify-content-between align-items-center tp-attribute-title collapsible">
                <h6 class="mb-0">
                    <span t-esc="a.name" />
                </h6>
                <span class="accordion-indicator">
                    <i class="fa fa-chevron-right"></i>
                </span>
            </div>
        </xpath>
        <xpath expr="//t[@t-foreach='attributes']/li/t[3]/t" position="replace">
            <div class="tp-filter-collapse-area pt-3 collapsible">
                <ul class="list-unstyled d-flex flex-wrap ml-0 tp-product-filter-scrollbar p-1">
                    <t t-foreach="a.value_ids" t-as="v">
                        <li t-att-data-search-term="v.name">
                            <label t-attf-style="background-color:#{v.html_color or v.name}" t-attf-class="mr-2 css_attribute_color #{'active' if v.id in attrib_set else ''}">
                                <input type="checkbox" name="attrib" t-att-value="'%s-%s' % (a.id,v.id)" t-att-checked="'checked' if v.id in attrib_set else None" t-att-title="v.name" />
                            </label>
                        </li>
                        
                    </t>
                </ul>
            </div>
        </xpath>
        </template>

        <template id="vm_list_categories" inherit_id="website_sale.categories_recursive" name="Custom List Categories">
        <xpath expr="//li[@class='nav-item']" position="replace">
            <li class="nav-item mt-2">
                <t t-if="c.child_id">
                    <i role="img" class="float-right text-muted fa fa-chevron-down" title="Unfold" aria-label="Unfold"></i>
                </t>
                <a t-att-href="keep('/shop/category/' + slug(c), category=0)" t-attf-class="p-0 text-body">
                    <div class="custom-control custom-radio">
                        <input type="radio" class="custom-control-input" t-att-checked="'checked' if c.id == category.id else None" />
                        <label class="custom-control-label"><span t-field="c.name"/></label>
                    </div>
                </a>
                <ul t-if="c.child_id" class="nav nav-pills flex-column nav-hierarchy">
                    <t t-foreach="c.child_id" t-as="c">
                        <t t-if="not search or c.id in search_categories_ids">
                            <t t-call="theme_vmax.vm_list_categories" />
                        </t>
                    </t>
                </ul>
            </li>
        </xpath>
        </template>

        <template id="vm_sidebar_categories" inherit_id="website_sale.products_categories" name="Custom Product Category">
        <xpath expr="//div[@id='wsale_products_categories_collapse']" position="attributes">
            <attribute name="class" separator=" " add="tp-sidebar-attribute" />
        </xpath>
        <xpath expr="//div[@id='wsale_products_categories_collapse']/ul" position="before">
            <h4 class="h_title mb-1 text-body">Lựa chọn mua sắm</h4>
        </xpath>
        <xpath expr="//div[@id='wsale_products_categories_collapse']/ul" position="replace">
            <ul class="nav nav-pills flex-column mb-4" id="o_shop_collapse_category">
                <li class="nav-item">
                    <a t-att-href="keep('/shop', category=0)" t-attf-class="p-0 text-body o_not_editable">
                        <div class="custom-control custom-radio">
                            <input type="radio" class="custom-control-input" t-att-checked="'checked' if not category else None" />
                            <label class="custom-control-label">Tất cả sản phẩm</label>
                        </div>
                    </a>
                </li>
                <t t-foreach="categories" t-as="c">
                    <t t-call="website_sale.categories_recursive" />
                </t>
            </ul>
        </xpath>
        </template>

        <template id="vm_products_item" inherit_id="website_sale.products_item">
        <xpath expr="//form/div" position="replace">
            <div class="card-body p-1">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                <div class="ribbon-wrapper">
                    <a href="#" role="button" class="ribbon btn btn-danger">Sale</a>
                </div>
                <a t-att-href="product_href" class="d-block h-100" itemprop="url">
                    <span t-field="product.image_1920"
                        t-options="{'widget': 'image', 'preview_image': 'image_1024' if product_image_big else 'image_256'}"
                        class="d-flex h-100 justify-content-center align-items-center"/>
                </a>
            </div>
        </xpath>
        </template>

        <template id="vm_products" inherit_id="website_sale.products" active="True" name="List Products">

        <!-- Ẩn thanh products_pager để viết lại -->
        <xpath expr="//div[@id='wrap']/div[2]/div" position="attributes">
            <attribute name="class" separator=" " add="d-none" />
        </xpath>

        <!-- Chèn thanh lọc dữ liệu, tiền tệ, chế độ hiển thị ở phía trên danh sách sản phẩm -->
        <xpath expr="//div[@id='wrap']/div[2]/div" position="after">
            <div class="product_top_nav">
                <div class="row">
                    <div class="col-12">
                        <div class="border-bottom">
                            <div class="d-lg-flex justify-content-between align-items-center py-2">
                                <div class="d-flex flex-column flex-md-row align-items-md-center mt-md-2 mt-lg-0"></div>
                                <div class="d-flex mt-3 mt-md-0 align-items-center justify-content-between">
                                    <t t-set="website_sale_pricelists" t-value="website.get_pricelist_available(show_visible=True)" />
                                    <div t-attf-class="dropdown#{'' if website_sale_pricelists and len(website_sale_pricelists)&gt;1 else ' d-none'} #{_classes} mr-3 dropdown_options">
                                        <t t-set="curr_pl" t-value="website.get_current_pricelist()" />
                                        <h6 class="d-inline mr-2">Tiền tệ :</h6>
                                        <a role="button" href="#" class="dropdown-toggle text-body py-2" data-toggle="dropdown">
                                            <t t-esc="curr_pl and curr_pl.name or ' - '" />
                                        </a>
                                        <div class="dropdown-menu" role="menu">
                                            <t t-foreach="website_sale_pricelists" t-as="pl">
                                                <a role="menuitem" t-att-href="'/shop/change_pricelist/%s' % pl.id" class="dropdown-item">
                                                    <span class="switcher_pricelist" t-att-data-pl_id="pl.id" t-esc="pl.name" />
                                                </a>
                                            </t>
                                        </div>
                                    </div>
                                    
                                    <t t-set="list_price_desc_label">Catalog price: High to Low</t>
                                    <t t-set="list_price_asc_label">Catalog price: Low to High</t>
                                    <t t-set="name_asc_label">Name: A to Z</t>
                                    <t t-set="name_desc_label">Name: Z to A</t>
                                    <t t-set="website_sale_sortable" t-value="[
                                        (list_price_desc_label, 'list_price desc'),
                                        (list_price_asc_label, 'list_price asc'),
                                        (name_asc_label, 'name asc'),
                                        (name_desc_label, 'name desc')
                                    ]"/>
                                    <t t-set="website_sale_sortable_current" t-value="[sort for sort in website_sale_sortable if sort[1]==request.params.get('order', '')]"/>
                                    <div class="dropdown mr-3 dropdown_options">
                                        <h6 class="d-inline mr-2">Sắp xếp theo :</h6>
                                        <a role="button" href="#" class="dropdown-toggle text-body py-2" data-toggle="dropdown">
                                            <t t-if='len(website_sale_sortable_current)'>
                                                <t t-raw='website_sale_sortable_current[0][0]'/>
                                            </t>
                                            <t t-else='1'>
                                                Chọn bộ lọc
                                            </t>
                                            <i class="fa fa-sort-amount-asc d-lg-none"/>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right" role="menu">
                                            <t t-foreach="website_sale_sortable" t-as="sortby">
                                                <a role="menuitem" rel="noindex,nofollow" t-att-href="keep('/shop', order=sortby[1])" class="dropdown-item">
                                                    <span t-raw="sortby[0]"/>
                                                </a>
                                            </t>
                                        </div>
                                    </div>
                                    <div class="btn-group btn-group-toggle d-none d-md-inline-flex o_wsale_apply_layout py-2 ml-4" data-toggle="buttons">
                                        <label t-attf-class="btn btn-secondary #{'active' if layout_mode != 'list' else None} fa fa-th-large o_wsale_apply_grid" title="Grid">
                                            <input type="radio" name="wsale_products_layout" t-att-checked="'checked' if layout_mode != 'list' else None"/>
                                        </label>
                                        <label t-attf-class="btn btn-secondary #{'active' if layout_mode == 'list' else None} fa fa-th-list o_wsale_apply_list" title="List">
                                            <input type="radio" name="wsale_products_layout" t-att-checked="'checked' if layout_mode == 'list' else None"/>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>

        <!-- Thay thế phần products_grid mặc định -->
        <xpath expr="//div[@id='products_grid']" position="replace">
            <div id="products_grid" t-attf-class="col #{'o_wsale_layout_list' if layout_mode == 'list' else ''}">
                <t t-if="category">
                    <t t-set='editor_msg'>Drag building blocks here to customize the header for "<t t-esc='category.name'/>" category.</t>
                    <div id="category_header" t-att-data-editor-message="editor_msg" t-field="category.website_description"/>
                </t>
                <!-- Chuyển từ table mặc định sang col -->
                <div t-if="bins" class="o_wsale_products_grid_table_wrapper">
                    <div id="vm_products_grid_view">
                        <div class="container">
                            <div class="row vmp_list_box">
                            <t t-foreach="bins" t-as="tr_product">
                                <t t-foreach="tr_product" t-as="td_product">
                                    <t t-if="td_product">
                                        <t t-set="product" t-value="td_product['product']" />
                                        <t t-att-colspan="td_product['x'] != 1 and td_product['x']"
                                            t-att-rowspan="td_product['y'] != 1 and td_product['y']"
                                            t-attf-class="oe_product #{td_product['class']}">
                                            <div t-attf-class="col-md-4 col-sm-6 list-items mb-3">
                                                <div class="h-100 s_card_style shadow-sm">
                                                    <t t-call="theme_vmax.vm_products_item">
                                                        <t t-set="product_image_big" t-value="td_product['x'] + td_product['y'] &gt; 2"/>
                                                    </t>
                                                </div>
                                                
                                            </div>
                                        </t>
                                    </t>
                                    <td t-else=""/>
                                </t>
                            </t>
                        </div>
                        </div>
                    </div>
                </div>
                <t t-else="">
                    <div class="text-center text-muted">
                        <t t-if="not search">
                            <h3 class="mt8">No product defined</h3>
                            <p t-if="category">No product defined in category "<strong t-esc="category.display_name"/>".</p>
                        </t>
                        <t t-else="">
                            <h3 class="mt8">No results</h3>
                            <p>No results for "<strong t-esc='search'/>"<t t-if="category"> in category "<strong t-esc="category.display_name"/>"</t>.</p>
                        </t>
                        <p t-ignore="true" groups="sales_team.group_sale_manager">Click <i>'New'</i> in the top-right corner to create your first product.</p>
                    </div>
                </t>
            </div>
        </xpath>
        
        </template>

        <!-- Chèn thêm phần mô tả sản phẩm -->
        <template id="nav_tabs_spec_prod" inherit_id="website_sale.product" active="True" name="Description &amp; Other Contents">
        <xpath expr="//section[@id='product_detail']" position="after">
            <section class="oe_structure"/>
            <div id="sp-product-menu" class="container">
                <div class="card bg-white">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active"
                                    id="nav_tabs_link_1"
                                    data-toggle="tab"
                                    href="#nav_tabs_content_1"
                                    role="tab"
                                    aria-controls="nav_tabs_content_1"
                                    aria-selected="true">Description</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    id="nav_tabs_link_2"
                                    data-toggle="tab"
                                    href="#nav_tabs_content_2"
                                    role="tab"
                                    aria-controls="nav_tabs_content_2"
                                    aria-selected="false">Features</a>
                            </li>
                            <li class="nav-item" t-if="is_product_comment">
                                <a class="nav-link"
                                    id="nav_tabs_link_3"
                                    data-toggle="tab"
                                    href="#nav_tabs_content_3"
                                    role="tab"
                                    aria-controls="nav_tabs_content_3"
                                    aria-selected="false">Review</a>
                            </li>
                            <li class="nav-item" t-if="is_recommended_products and len(product.alternative_product_ids) > 0">
                                <a class="nav-link"
                                    id="nav_tabs_link_4"
                                    data-toggle="tab"
                                    href="#nav_tabs_content_4"
                                    role="tab"
                                    aria-controls="nav_tabs_content_4"
                                    aria-selected="false">Alternative </a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body tab-content">
                        <div class="tab-pane fade show active"
                            id="nav_tabs_content_1"
                            role="tabpanel"
                            aria-labelledby="nav_tabs_link_1">
                            <div class="sp-product-tabs-description">
                                <div class="oe_structure"/>
                                <p t-if="product.description_sale != False" t-esc="product.description_sale"/>
                                <p t-else="">Currently No description Available</p>
                                <div class="oe_structure"/>
                            </div>
                        </div>
                        <div class="tab-pane fade product_attributes"
                            id="nav_tabs_content_2"
                            role="tabpanel"
                            aria-labelledby="nav_tabs_link_2">
                            <!-- <t t-call="support_theme_shopoint.product_feature_accordion"/> -->
                        </div>
                        <div class="tab-pane fade"
                            id="nav_tabs_content_3"
                            role="tabpanel"
                            aria-labelledby="nav_tabs_link_3"
                            t-if="is_product_comment">
                            <div class="o_shop_discussion_rating">
                                <section class="container mt16 mb16">
                                    <hr/>
                                    <div class="row">
                                        <div class="col-lg-8 offset-lg-2">
                                            <t t-call="portal.message_thread">
                                                <t t-set="object" t-value="product"/>
                                                <t t-set="display_rating" t-value="True"/>
                                            </t>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="tab-pane fade"
                            id="nav_tabs_content_4"
                            role="tabpanel"
                            aria-labelledby="nav_tabs_link_4"
                            t-if="is_recommended_products and len(product.alternative_product_ids) > 0">
                            <div class="container sp-alternative-products-wrapper" >
                                <t t-set="product_variant" t-value="product_variant or product._create_first_product_variant()"/>
                                <t t-set="id_list" t-value="[product_variant.id] if product_variant else []"/>
                                <t t-foreach="product.alternative_product_ids" t-as="alt_product">
                                    <t t-set="alt_product_variant_id" t-value="alt_product._create_first_product_variant().id"/>
                                    <t t-if="alt_product_variant_id" t-set="id_list" t-value="id_list + [alt_product_variant_id]"/>
                                </t>
                                <t t-set="ids" t-value="','.join([str(id) for id in id_list])"/>
                                <div class="sp-alternative-products mt16 owl-carousel owl-theme">
                                    <t t-foreach="product.alternative_product_ids" t-as="alt_product">
                                        <div class="text-center sp-alternative-product">
                                            <t t-set="combination_info" t-value="alt_product._get_combination_info()"/>
                                            <t t-set="product_variant" t-value="alt_product.env['product.product'].browse(combination_info['product_id'])"/>
                                            <a class="img-wrapper" t-if="product_variant" t-attf-href="/shop/product/#{ slug(alt_product) }">
                                                <span t-field="product_variant.image_1920" t-options="{'widget': 'image', 'resize': '300x300'}"/>
                                            </a>
                                            <div t-else="" t-field="alt_product.image_1920" t-options="{'widget': 'image', 'resize': '300x300'}" />
                                            <h6>
                                                <a t-attf-href="/shop/product/#{ slug(alt_product) }" style="display: block">
                                                    <span t-att-title="alt_product.name" t-field="alt_product.name" class="o_text_overflow" style="display: block;" />
                                                </a>
                                            </h6>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
    </data>
</odoo>